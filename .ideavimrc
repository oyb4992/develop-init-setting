"==============================================================================
" .ideavimrc - IdeaVim 설정 파일 (개선 제안 반영)
"==============================================================================

"------------------------------------------------------------------------------
" 1. 기본 설정 (Basic Settings)
"------------------------------------------------------------------------------
set incsearch
set hls
set clipboard+=ideaput,unnamed
set number relativenumber
set ideajoin
set idearefactormode=keep
set scrolljump=5
set scrolloff=8
set sidescroll=5
set sidescrolloff=8
set nowrap
set backspace=indent,eol,start
set showcmd
set showmode
set cursorline
" 커서를 줄 끝 다음 칸까지 이동 허용
set virtualedit=onemore
nnoremap Q gq " map 대신 nnoremap 사용

"------------------------------------------------------------------------------
" 2. 들여쓰기 설정 (Indentation Settings)
"------------------------------------------------------------------------------
set autoindent
set smartindent
set tabstop=4
set shiftwidth=4
set expandtab
set softtabstop=4

"------------------------------------------------------------------------------
" 3. 검색 및 표시 설정 (Search & Display Settings)
"------------------------------------------------------------------------------
set ignorecase
set smartcase
set visualbell
set listchars=tab:»\ ,trail:·,nbsp:␣,extends:>,precedes:<
set list

"------------------------------------------------------------------------------
" 4. 텍스트 포맷 설정 (Text Format Settings)
"------------------------------------------------------------------------------
set formatoptions=tcqj
set formatoptions+=r
set formatoptions+=o

"------------------------------------------------------------------------------
" 5. IdeaVim 플러그인 활성화 (IdeaVim Extensions)
"------------------------------------------------------------------------------
" 주의: 'set NERDTree'는 유효한 옵션이 아니므로 제거됨 (아래 매핑 참고)
" IdeaVim 내장 기능 활성화 (`set` 구문 사용)
set highlightedyank
set commentary
set surround
set easymotion
set multiple-cursors
set peekaboo
set which-key
set quickscope

"------------------------------------------------------------------------------
" 6. WhichKey 및 Leader 키 설정 (WhichKey & Leader Settings)
"------------------------------------------------------------------------------
set notimeout
let g:WhichKey_FontSize = 14
let mapleader=" "

"------------------------------------------------------------------------------
" 7. IDE 액션 매핑 (IDE Action Mappings)
"------------------------------------------------------------------------------
" 코드 자동 들여쓰기 포맷팅
nnoremap <leader>r :action ReformatCode<CR>

" j, k, H, L 기본 이동 매핑 (nnoremap 사용)
nnoremap j gj
nnoremap k gk
nnoremap H ^
nnoremap L $
vnoremap H ^
vnoremap L $

" 클립보드 관련 매핑
" Normal 모드: Ctrl+V를 비주얼 블록 모드 시작으로 매핑 (Vim 기본 동작 명시)
nnoremap <C-v> <C-v>
" Insert 모드: Ctrl+V를 IDE의 '붙여넣기' 액션으로 매핑
inoremap <C-v> <Esc>:action EditorPaste<CR>i
" Visual 모드: Ctrl+V를 IDE의 '붙여넣기' 액션으로 매핑 (선택 영역 교체)
vnoremap <C-v> :action EditorPaste<CR>
" Command-line 모드: Ctrl+V를 '+' 레지스터 (시스템 클립보드) 붙여넣기로 매핑
cnoremap <C-v> <C-R>+

" 탭 관리 (nnoremap 및 :action 사용)
" 현재 탭 (파일) 닫기
nnoremap <leader>tx :action CloseContent<CR>
" 모든 탭 닫기
nnoremap <leader>ta :action CloseAllEditors<CR>
" 현재 탭 외 모든 탭 닫기
nnoremap <leader>to :action CloseAllEditorsButActive<CR>
" 다음 탭으로 이동
nnoremap <leader>t] :action NextTab<CR>
" 이전 탭으로 이동
nnoremap <leader>t[ :action PreviousTab<CR>
" 수정되지 않은 모든 탭 닫기
nnoremap <leader>tu :action CloseAllUnmodifiedEditors<CR>
" 현재 창 분할 방향 전환
nnoremap <leader>tc :action ChangeSplitOrientation<CR>
" 현재 탭 기준 왼쪽 모든 탭 닫기
nnoremap <leader>tl :action CloseAllToTheLeft<CR>
" 현재 탭 기준 오른쪽 모든 탭 닫기
nnoremap <leader>tr :action CloseAllToTheRight<CR>

" 디버깅 (nnoremap 및 :action 사용)
" Debug configuration 선택/실행
nnoremap <leader>dd :action ChooseDebugConfiguration<CR>
" 실행/디버깅 중지
nnoremap <leader>ds :action Stop<CR>
" 현재 줄에 라인 브레이크포인트 설정/해제
nnoremap <leader>db :action ToggleLineBreakpoint<CR>

" 탐색 및 Search (nnoremap/vnoremap 및 :action 사용)
" 최근 파일/툴윈도우 등을 전환하는 Switcher 열기
nnoremap <leader>, :action Switcher<CR>
" 프로젝트 뷰 열기 (기존 NERDTree 대신) - 필요시 :NERDTree<CR> 복원
nnoremap <leader>e :action ActivateProjectToolWindow<CR>
" 현재 파일 위치에서 프로젝트 뷰 열기 (만약 NERDTree 선호 시 :NERDTreeFind<CR>)
nnoremap <leader>E :action SelectInProjectView<CR>
" Visual 모드에서 선택 영역 검색
vnoremap <C-F> :action Find<CR>

" 다중 커서 관련 매핑 (nnoremap/xnoremap 사용, <Plug>는 IdeaVim 플러그인 매핑)
" 다음 전체 일치 항목 선택 (Ctrl+N)
nmap <C-n> <Plug>NextWholeOccurrence
xmap <C-n> <Plug>NextWholeOccurrence
" 다음 일치 항목 선택 (g Ctrl+N)
nmap g<C-n> <Plug>NextOccurrence
xmap g<C-n> <Plug>NextOccurrence
" 현재 선택 항목 건너뛰기 (Ctrl+X)
xmap <C-x> <Plug>SkipOccurrence
" 현재 선택 항목 제거 (Ctrl+P)
xmap <C-p> <Plug>RemoveOccurrence
" 모든 전체 일치 항목 선택 (Leader Ctrl+N)
nmap <leader><C-n> <Plug>AllWholeOccurrences
xmap <leader><C-n> <Plug>AllWholeOccurrences
" 모든 일치 항목 선택 (Leader g Ctrl+N)
nmap <leader>g<C-n> <Plug>AllOccurrences
xmap <leader>g<C-n> <Plug>AllOccurrences

" 창 분할 및 최대화 (nnoremap 및 :action 사용)
" 가로 창 분할
nnoremap <leader>- :action SplitHorizontally<CR>
" 세로 창 분할
nnoremap <leader><bar> :action SplitVertically<CR>
" Distraction Free Mode 토글 (방해금지 모드)
nnoremap <leader>m :action ToggleDistractionFreeMode<CR>

" 코드 탐색 (Go To...) (nnoremap 및 :action 사용)
" 선언으로 이동 (Ctrl+B)
nnoremap <leader>gd :action GotoDeclaration<CR>
" 구현체로 이동 (Ctrl+Alt+B)
nnoremap <leader>gi :action GotoImplementation<CR>
" 사용 위치 찾기 (Alt+F7)
nnoremap <leader>gu :action ShowUsages<CR>
" 타입 계층 보기 (Ctrl+H)
nnoremap <leader>th :action TypeHierarchy<CR>
" 현재 코드 블록 시작으로 이동
nnoremap <leader>gm :action EditorCodeBlockStart<CR>
" 메소드 계층 보기 (Ctrl+Shift+H) (주석 처리 유지 - 필요시 해제)
" nnoremap <leader>mh :action MethodHierarchy<CR>
" 이름 변경 (Shift+F6) (주석 처리 유지 - 필요시 해제)
" nnoremap <leader>rn :action RenameElement<CR>

" Gradle 태스크 실행 (nnoremap 및 :action 사용)
nnoremap <leader>ge :action Gradle.ExecuteTask<CR>

" 현재 파일의 Git 로그 (File History) 보기 (nnoremap 및 :action 사용)
nnoremap <leader>gl :action Vcs.ShowTabbedFileHistory<CR>

"------------------------------------------------------------------------------
" 8. 일반 기능 키 매핑 (General Key Mappings)
"------------------------------------------------------------------------------
" 창 이동 (nnoremap 사용)
" 이전에 예시로 주석 처리된 nmap 설정
"nmap <C-h> <C-w>h
"nmap <C-l> <C-w>l

" 창 좌우 이동
nnoremap <C-h> <C-w>h
nnoremap <C-l> <C-w>l

" 창 상하 이동
nnoremap <C-k> <C-w>k
nnoremap <C-j> <C-w>j
" 참고: IntelliJ 기본 창 이동(Ctrl+Alt+Left/Right)과 충돌 피하기 위함

" 줄 이동 (IdeaVim 기능 활용, nnoremap/inoremap/vnoremap 사용)
" 한 줄 아래로 이동
nnoremap <C-S-j> :action MoveLineDown<CR>
inoremap <C-S-j> <Esc>:action MoveLineDown<CR>i
vnoremap <C-S-j> :action MoveLineDown<CR>
" 한 줄 위로 이동
nnoremap <C-S-k> :action MoveLineUp<CR>
inoremap <C-S-k> <Esc>:action MoveLineUp<CR>i
vnoremap <C-S-k> :action MoveLineUp<CR>

"------------------------------------------------------------------------------
" 9. 플러그인 설정 (Plugin Settings)
"------------------------------------------------------------------------------
let g:highlightedyank_highlight_duration = 200

let g:qs_highlight_on_keys = ['f', 'F', 't', 'T']
let g:qs_primary_color = '#ff0000'
let g:qs_secondary_color = '#00ff00'
let g:qs_disable_for_diffs = 1

let g:EasyMotion_smartcase = 1
let g:EasyMotion_do_mapping = 0
" EasyMotion 매핑 (nmap 사용)
nmap <leader>f <Plug>(easymotion-s)
nmap <leader>F <Plug>(easymotion-s2)
nmap <Leader>L <Plug>(easymotion-bd-jk)
nmap <Leader>/ <Plug>(easymotion-sn)

"------------------------------------------------------------------------------
" 10. 레지스터 및 마크 설정 (Registers & Marks)
"------------------------------------------------------------------------------
" 레지스터 목록 보기 (주석 처리 유지 - 필요시 해제)
" nnoremap <leader>x :registers<CR>
" 마크 목록 보기 (nnoremap 사용)
nnoremap <silent> <leader>M :marks<CR>
" 모든 소문자/대문자 마크 삭제 (주석 처리 유지 - 필요시 해제)
" nnoremap <silent> <leader>Md :delmarks a-z A-Z<CR>